<p align="center">
    <img src="https://sentry-brand.storage.googleapis.com/sentry-logo-black.png" width="280">
    <br />
</p>

# Craft: Universal Release Tool (And More)

[![Travis](https://img.shields.io/travis/getsentry/craft.svg)](https://travis-ci.org/getsentry/craft)
[![GitHub release](https://img.shields.io/github/release/getsentry/craft.svg)](https://github.com/getsentry/craft/releases/latest)
[![npm version](https://img.shields.io/npm/v/@sentry/craft.svg)](https://www.npmjs.com/package/@sentry/craft)
[![license](https://img.shields.io/github/license/getsentry/craft.svg)](https://github.com/getsentry/craft/blob/master/LICENSE)

## Installation

The tool comes as NPM package and can be installed via npm or yarn:

```bash
npm install -g @sentry/craft
yarn add -g @sentry/craft
```

## Usage

```
$ craft -h
craft <command>

Commands:
  craft demo     ðŸŽ¬ Run a demo of craft                             [aliases: d]
  craft publish  ðŸ›« Publish artifacts                               [aliases: p]

Options:
  -v, --version  Show version number                                   [boolean]
  -h, --help     Show help                                             [boolean]
```

### Publishing the release

The command will find a release branch for the provided version (tag) and
publish the found artifacts to the configured targets.

```
$ craft publish -h
craft publish

ðŸ›« Publish artifacts

Options:
  --target, -t            Publish to this target
                              [string] [choices: "github", "npm", "pypi", "all"]
  --rev, -r               Source revision to publish                    [string]
  --tag, -T               Version to publish                 [string] [required]
  --merge-release-branch  Merge the release branch after publishing
                                                       [boolean] [default: true]
```

## Target Configuration

The configuration specifies which release targets to run for the repository. To
run more targets, list the target identifiers under the `targets` key.

```yaml
targets:
  - name: github
  - name: npm
```

### GitHub (`github`)

Create a release on Github. If a Markdown changelog is present in the
repository, this target tries to read the release name and description from the
changelog. Otherwise, defaults to the tag name and tag's commit message.

**Environment**

| Name               | Description                                                        |
| ------------------ | ------------------------------------------------------------------ |
| `GITHUB_API_TOKEN` | Personal GitHub API token (seeh ttps://github.com/settings/tokens) |

**Configuration**

| Option      | Description                                                          |
| ----------- | -------------------------------------------------------------------- |
| `changelog` | **optional**. Path to the changelog file. Defaults to `CHANGELOG.md` |

**Example:**

```yaml
targets:
  - name: github
    changelog: CHANGES
```

### NPM (`npm`)

Releases a NPM package to the public registry. This requires a package tarball
generated by `npm pack` in the artifacts. The file will be uploaded to the
registry with `npm publish`. This requires NPM to be authenticated with
sufficient permissions to publish the package.

**Environment**

The `npm` utility must be installed on the system.

| Name      | Description                                                 |
| --------- | ----------------------------------------------------------- |
| `NPM_BIN` | **optional**. Path to the npm executable. Defaults to `npm` |

**Configuration**

| Option   | Description                                                                      |
| -------- | -------------------------------------------------------------------------------- |
| `access` | **optional**. Visibility for scoped packages: `public` (default) or `restricted` |

**Example**

```yaml
targets:
  - name: npm
    access: restricted
